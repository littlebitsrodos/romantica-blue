let currentLang="en",currentMonth=(new Date).getMonth(),currentYear=(new Date).getFullYear(),bookedDates=[],selectedCheckIn=null,selectedCheckOut=null;const PRICING={seasons:{low:{months:[11,12,1,2,3],weekly:400,nightly:400},mid:{months:[4,5,6,9,10],weekly:600,nightly:600},peak:{months:[7,8],weekly:800,nightly:800}},currency:"€"},STRIPE_LINKS={low:"#",mid:"#",peak:"#"};function getPaymentLink(e,t){const n=getSeasonForDate(e),a=STRIPE_LINKS[n];return"#"===a?"#":`${a}?quantity=${t}`}function getSeasonForDate(e){const t=new Date(e+"T00:00:00").getMonth()+1;for(const[e,n]of Object.entries(PRICING.seasons))if(n.months.includes(t))return e;return"mid"}function getNightlyRate(e){return PRICING.seasons[getSeasonForDate(e)].nightly}function calculateTotalPrice(e,t){if(!e||!t)return 0;let n=0,a=new Date(e+"T00:00:00");const o=new Date(t+"T00:00:00");for(;a<o;)n+=getNightlyRate(formatDate(a)),a.setDate(a.getDate()+1);return n}function initLanguageSwitcher(){const e=document.querySelectorAll(".lang-btn");e.forEach(t=>{t.addEventListener("click",()=>{setLanguage(t.dataset.lang),e.forEach(e=>e.classList.remove("active")),t.classList.add("active")})})}function setLanguage(e){currentLang=e;const t=translations[e];document.querySelectorAll("[data-translate]").forEach(e=>{const n=e.dataset.translate.split(".");let a=t;for(const e of n)a=a?.[e];a&&(e.textContent=a)}),document.querySelectorAll("[data-translate-placeholder]").forEach(e=>{const n=e.dataset.translatePlaceholder.split(".");let a=t;for(const e of n)a=a?.[e];a&&(e.placeholder=a)}),document.documentElement.lang="el"===e?"el":e,renderCalendar()}function initNavigation(){const e=document.querySelector(".navbar"),t=document.querySelector(".mobile-menu-btn"),n=document.querySelector(".nav-links");window.addEventListener("scroll",()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")}),t&&t.addEventListener("click",()=>{n.classList.toggle("active")}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const a=document.querySelector(e.getAttribute("href"));a&&(a.scrollIntoView({behavior:"smooth",block:"start"}),n?.classList.remove("active"))})})}document.addEventListener("DOMContentLoaded",()=>{initLanguageSwitcher(),initNavigation(),initGallery(),initCalendar(),initContactForm(),initScrollAnimations(),setLanguage("en");const e=document.getElementById("google-fonts");e&&(e.media="all")});let galleryRotationInterval=null,currentGalleryIndex=0,currentLightboxIndex=0,galleryImages=[],touchStartX=0,touchEndX=0;function initGallery(){const e=document.querySelectorAll(".gallery-item"),t=document.querySelector(".lightbox"),n=t?.querySelector("img"),a=t?.querySelector(".lightbox-close"),o=t?.querySelector(".lightbox-prev"),r=t?.querySelector(".lightbox-next"),c=document.querySelector(".gallery-grid");galleryImages=Array.from(e).map(e=>({src:e.querySelector("img")?.src,alt:e.querySelector("img")?.alt})),initMobileCarousel(),startGalleryRotation(),c&&(c.addEventListener("mouseenter",()=>stopGalleryRotation()),c.addEventListener("mouseleave",()=>startGalleryRotation())),e.forEach((e,t)=>{e.addEventListener("click",()=>openLightbox(t))}),a&&a.addEventListener("click",closeLightbox),o&&o.addEventListener("click",()=>navigateLightbox(-1)),r&&r.addEventListener("click",()=>navigateLightbox(1)),t&&(t.addEventListener("click",e=>{e.target===t&&closeLightbox()}),t.addEventListener("touchstart",e=>{touchStartX=e.changedTouches[0].screenX},{passive:!0}),t.addEventListener("touchend",e=>{touchEndX=e.changedTouches[0].screenX,handleLightboxSwipe()},{passive:!0})),document.addEventListener("keydown",e=>{const t=document.querySelector(".lightbox");t?.classList.contains("active")&&("Escape"===e.key&&closeLightbox(),"ArrowLeft"===e.key&&navigateLightbox(-1),"ArrowRight"===e.key&&navigateLightbox(1))}),n&&(n.style.cursor="pointer",n.addEventListener("click",e=>{const t=n.getBoundingClientRect();navigateLightbox(e.clientX-t.left<t.width/3?-1:1)}))}function initMobileCarousel(){const e=document.querySelector(".gallery-carousel"),t=e?.querySelector(".carousel-track"),n=e?.querySelectorAll(".carousel-slide"),a=e?.querySelector(".carousel-prev"),o=e?.querySelector(".carousel-next"),r=e?.querySelector(".carousel-dots");if(!e||!n?.length)return;let c=0,l=null;function s(e){c=e,c<0&&(c=n.length-1),c>=n.length&&(c=0),t.style.transform=`translateX(-${100*c}%)`,r?.querySelectorAll(".carousel-dot").forEach((e,t)=>{e.classList.toggle("active",t===c)})}function i(){s(c+1)}function d(){s(c-1)}n.forEach((e,t)=>{const n=document.createElement("button");n.className="carousel-dot "+(0===t?"active":""),n.setAttribute("aria-label",`Go to slide ${t+1}`),n.addEventListener("click",()=>s(t)),r?.appendChild(n)}),a?.addEventListener("click",d),o?.addEventListener("click",i);let u=0;function g(){h(),l=setInterval(i,6e3)}function h(){l&&clearInterval(l)}t?.addEventListener("touchstart",e=>{u=e.changedTouches[0].screenX,h()},{passive:!0}),t?.addEventListener("touchend",e=>{const t=e.changedTouches[0].screenX,n=u-t;Math.abs(n)>50&&(n>0?i():d()),g()},{passive:!0}),n.forEach((e,t)=>{e.addEventListener("click",()=>openLightbox(t))}),g()}function openLightbox(e){const t=document.querySelector(".lightbox"),n=t?.querySelector("img"),a=t?.querySelector(".lightbox-counter .current"),o=t?.querySelector(".lightbox-counter .total");t&&n&&galleryImages[e]&&(currentLightboxIndex=e,n.src=galleryImages[e].src,n.alt=galleryImages[e].alt,a&&(a.textContent=e+1),o&&(o.textContent=galleryImages.length),t.classList.add("active"),document.body.style.overflow="hidden",stopGalleryRotation())}function navigateLightbox(e){currentLightboxIndex+=e,currentLightboxIndex<0&&(currentLightboxIndex=galleryImages.length-1),currentLightboxIndex>=galleryImages.length&&(currentLightboxIndex=0);const t=document.querySelector(".lightbox"),n=t?.querySelector("img"),a=t?.querySelector(".lightbox-counter .current");n&&galleryImages[currentLightboxIndex]&&(n.src=galleryImages[currentLightboxIndex].src,n.alt=galleryImages[currentLightboxIndex].alt),a&&(a.textContent=currentLightboxIndex+1)}function handleLightboxSwipe(){const e=touchStartX-touchEndX;Math.abs(e)>50&&navigateLightbox(e>0?1:-1)}function startGalleryRotation(){const e=document.querySelectorAll(".gallery-item");0!==e.length&&(stopGalleryRotation(),galleryRotationInterval=setInterval(()=>{e.forEach(e=>e.classList.remove("gallery-highlight")),currentGalleryIndex=(currentGalleryIndex+1)%e.length,e[currentGalleryIndex].classList.add("gallery-highlight")},5e3))}function stopGalleryRotation(){galleryRotationInterval&&(clearInterval(galleryRotationInterval),galleryRotationInterval=null),document.querySelectorAll(".gallery-item").forEach(e=>{e.classList.remove("gallery-highlight")})}function closeLightbox(){const e=document.querySelector(".lightbox");e&&(e.classList.remove("active"),document.body.style.overflow="",startGalleryRotation())}function initCalendar(){loadBookedDates();const e=document.querySelector(".calendar-prev"),t=document.querySelector(".calendar-next");e&&e.addEventListener("click",()=>{currentMonth--,currentMonth<0&&(currentMonth=11,currentYear--),renderCalendar()}),t&&t.addEventListener("click",()=>{currentMonth++,currentMonth>11&&(currentMonth=0,currentYear++),renderCalendar()}),renderCalendar()}function loadBookedDates(){const e=new Date;bookedDates=[formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+3)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+4)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+5)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+6)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+7)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+15)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+16)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+17)),formatDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+18))]}async function fetchICalData(e){try{const t=await fetch(e);return parseICalData(await t.text())}catch(e){return console.error("Error fetching iCal data:",e),[]}}function parseICalData(e){const t=[],n=e.split("\n");let a=!1,o=null,r=null;for(const e of n)if(e.startsWith("BEGIN:VEVENT"))a=!0;else if(e.startsWith("END:VEVENT")){if(o&&r){let e=new Date(o);const n=new Date(r);for(;e<n;)t.push(formatDate(e)),e.setDate(e.getDate()+1)}a=!1,o=null,r=null}else if(a)if(e.startsWith("DTSTART")){const t=e.match(/(\d{4})(\d{2})(\d{2})/);t&&(o=`${t[1]}-${t[2]}-${t[3]}`)}else if(e.startsWith("DTEND")){const t=e.match(/(\d{4})(\d{2})(\d{2})/);t&&(r=`${t[1]}-${t[2]}-${t[3]}`)}return t}function formatDate(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function renderCalendar(){const e=document.querySelector(".calendar"),t=document.querySelector(".calendar-month");if(!e)return;const n=translations[currentLang].calendar;t&&(t.textContent=`${n.months[currentMonth]} ${currentYear}`),e.innerHTML="",n.days.forEach(t=>{const n=document.createElement("div");n.className="calendar-header",n.textContent=t,e.appendChild(n)});const a=new Date(currentYear,currentMonth,1).getDay(),o=new Date(currentYear,currentMonth+1,0).getDate(),r=new Date;for(let t=0;t<a;t++){const t=document.createElement("div");t.className="calendar-day empty",e.appendChild(t)}for(let t=1;t<=o;t++){const n=formatDate(new Date(currentYear,currentMonth,t)),a=document.createElement("div");a.className="calendar-day",a.textContent=t,a.dataset.date=n;new Date(currentYear,currentMonth,t)<new Date(r.getFullYear(),r.getMonth(),r.getDate())||bookedDates.includes(n)?a.classList.add("booked"):(a.classList.add("available"),a.classList.add(getSeasonForDate(n)+"-season"),a.addEventListener("click",()=>handleDateClick(n))),n===selectedCheckIn&&a.classList.add("check-in"),n===selectedCheckOut&&a.classList.add("check-out"),isInSelectedRange(n)&&a.classList.add("in-range"),e.appendChild(a)}updateSelectionDisplay()}function handleDateClick(e){!selectedCheckIn||selectedCheckIn&&selectedCheckOut?(selectedCheckIn=e,selectedCheckOut=null):e<selectedCheckIn?(selectedCheckOut=selectedCheckIn,selectedCheckIn=e):e===selectedCheckIn?selectedCheckIn=null:selectedCheckOut=e,selectedCheckIn&&selectedCheckOut&&hasBookedDatesInRange()&&(alert("Selected range contains unavailable dates. Please choose different dates."),selectedCheckOut=null),renderCalendar(),syncDatesToForm()}function isInSelectedRange(e){return!(!selectedCheckIn||!selectedCheckOut)&&(e>selectedCheckIn&&e<selectedCheckOut)}function hasBookedDatesInRange(){return!(!selectedCheckIn||!selectedCheckOut)&&bookedDates.some(e=>e>selectedCheckIn&&e<selectedCheckOut)}function updateSelectionDisplay(){const e=document.querySelector(".calendar-container");if(!e)return;let t=e.querySelector(".selection-display");if(t||(t=document.createElement("div"),t.className="selection-display",e.appendChild(t)),selectedCheckIn&&selectedCheckOut){const e=calculateNights(selectedCheckIn,selectedCheckOut),n=calculateTotalPrice(selectedCheckIn,selectedCheckOut),a=getPaymentLink(selectedCheckIn,e);t.innerHTML=`\n            <div class="selection-info">\n                <span class="selection-dates">\n                    <strong>Check-in:</strong> ${formatDisplayDate(selectedCheckIn)} → \n                    <strong>Check-out:</strong> ${formatDisplayDate(selectedCheckOut)}\n                </span>\n                <span class="selection-nights">${e} night${e>1?"s":""} — <strong>${PRICING.currency}${n}</strong></span>\n            </div>\n            <div class="selection-actions">\n                <button class="clear-selection-btn">Clear</button>\n                <a href="${a}" target="_blank" rel="noopener noreferrer" class="book-now-btn">\n                    Book Now\n                </a>\n            </div>\n        `;const o=t.querySelector(".clear-selection-btn");o&&o.addEventListener("click",clearDateSelection);const r=t.querySelector(".book-now-btn");r&&"#"===a&&r.addEventListener("click",e=>{e.preventDefault(),alert("Payment links coming soon! Please use the contact form below.")}),t.style.display="flex"}else if(selectedCheckIn){t.innerHTML=`\n            <div class="selection-info">\n                <span class="selection-dates">Check-in: ${formatDisplayDate(selectedCheckIn)} — Select check-out date</span>\n            </div>\n            <button class="clear-selection-btn">Clear</button>\n        `;const e=t.querySelector(".clear-selection-btn");e&&e.addEventListener("click",clearDateSelection),t.style.display="flex"}else t.style.display="none"}function formatDisplayDate(e){const t=new Date(e+"T00:00:00");return`${translations[currentLang].calendar.months[t.getMonth()].slice(0,3)} ${t.getDate()}, ${t.getFullYear()}`}function calculateNights(e,t){const n=new Date(e),a=new Date(t);return Math.round((a-n)/864e5)}function clearDateSelection(){selectedCheckIn=null,selectedCheckOut=null,renderCalendar(),syncDatesToForm()}function syncDatesToForm(){const e=document.getElementById("dates");e&&(selectedCheckIn&&selectedCheckOut?(e.value=`${formatDisplayDate(selectedCheckIn)} - ${formatDisplayDate(selectedCheckOut)}`,setTimeout(()=>{document.getElementById("contact")?.scrollIntoView({behavior:"smooth",block:"start"})},300)):e.value="")}function initContactForm(){const e=document.querySelector(".contact-form form");if(e){const t={maxSubmissions:3,windowMs:3e5};let n=JSON.parse(sessionStorage.getItem("formSubmissions")||"[]");e.addEventListener("submit",a=>{a.preventDefault();const o=Date.now();if(n=n.filter(e=>o-e<t.windowMs),n.length>=t.maxSubmissions)return void showFormMessage("Too many submissions. Please try again in a few minutes.","error");const r=new FormData(e),c=Object.fromEntries(r);if(c.name&&c.email&&c.message){if(isValidEmail(c.email))return c.website?(console.log("Bot detected"),showFormMessage("Thank you! We'll get back to you soon.","success"),void e.reset()):void fetch(e.action,{method:"POST",body:r,headers:{Accept:"application/json"}}).then(t=>{t.ok?(n.push(o),sessionStorage.setItem("formSubmissions",JSON.stringify(n)),showFormMessage("Thank you! We'll get back to you soon.","success"),e.reset()):showFormMessage("Oops! There was a problem sending your message.","error")}).catch(e=>{showFormMessage("Oops! There was a problem sending your message.","error")});showFormMessage("Please enter a valid email address.","error")}else showFormMessage("Please fill in all required fields.","error")})}}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function showFormMessage(e,t){const n=document.querySelector(".form-message");n&&n.remove();const a=document.createElement("div");a.className=`form-message ${t}`,a.textContent=e,a.style.cssText=`\n    padding: 1rem;\n    margin-top: 1rem;\n    border-radius: 8px;\n    text-align: center;\n    ${"success"===t?"background: #d4edda; color: #155724;":"background: #f8d7da; color: #721c24;"}\n  `;document.querySelector(".contact-form form").appendChild(a),setTimeout(()=>{a.remove()},5e3)}function initScrollAnimations(){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("animate-in"),e.unobserve(t.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll("section, .amenity-card, .bedroom-card").forEach(t=>{t.style.opacity="0",e.observe(t)})}